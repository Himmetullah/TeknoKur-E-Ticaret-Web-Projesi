@{
	ViewData["Title"] = ViewBag.KategoriAdi;
	Layout = "~/Views/Shared/_CustomerLayout.cshtml";
	var urunler = ViewBag.Urunler as List<Layer.Data.TblUrun>;
	var markaListesi = ViewBag.MarkaListesi as List<Layer.Data.TblMarka>;
}

<br />
<div class="shop-main-area mb-70">
	<div class="container">
		<div class="row">
			<!-- SOL: Filtre Paneli -->
			<div class="col-lg-3" style="position: sticky; top: 100px;">
				<form method="post" action="/Urun/KategoriFiltre">
					<input type="hidden" name="kategoriSeo" value="@ViewBag.KategoriSeo" />

					<h5>Markaya Göre</h5>
					@if (markaListesi != null)
					{
						foreach (var marka in markaListesi)
						{
							<div class="form-check">
								<input class="form-check-input" type="checkbox" name="markalar" value="@marka.MarkaAdi" id="marka-@marka.MarkaId">
								<label class="form-check-label" for="marka-@marka.MarkaId">@marka.MarkaAdi</label>
							</div>
						}
					}

					<h5 class="mt-3">Fiyata Göre</h5>
					<input type="number" name="minFiyat" placeholder="Min Fiyat" class="form-control mb-2" />
					<input type="number" name="maxFiyat" placeholder="Max Fiyat" class="form-control mb-2" />

					<div class="d-flex justify-content-between">
						<button type="submit" class="btn btn-primary btn-sm">Filtrele</button>
						<a href="/Urun/Kategori/@ViewBag.KategoriSeo" class="btn btn-secondary btn-sm">Sıfırla</a>
					</div>
				</form>
			</div>

			<!-- SAĞ: Ürün Listesi -->
			<div class="col-lg-9">
				@if (urunler != null && urunler.Any())
				{
					<div class="row">
						@foreach (var urun in urunler)
						{
							<div class="col-lg-4 col-md-6 col-sm-12 mb-4">
								<!-- single-product-start -->
								<div class="product-wrapper-2">
									<div class="product-img">
										<a href="~/@urun.UrunSeo">
											<img src="@urun.UrunResimUrl" alt="@urun.UrunAdi" class="first" />
											<img src="@urun.UrunResimUrl" alt="@urun.UrunAdi" class="second" />
										</a>
									</div>
									<div class="product-details-2">
										<h3>
											<a href="~/@urun.UrunSeo" style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; height: 25px;">
												@urun.UrunAdi
											</a>
										</h3>

										<div class="product-price">
											<ul>
												<li class="new-price">@urun.UrunFiyat.ToString("C2")</li>
											</ul>
										</div>

										<p style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 38px;">
											@urun.UrunAciklama
										</p>

										<div class="action-inner mt-20 d-flex justify-content-between align-items-center">
											<div class="product-button-3">
												<a href="javascript:void(0)" class="sepete-ekle-btn btn btn-sm btn-outline-primary" data-id="@urun.UrunId">
													<i class="fa fa-shopping-cart"></i> Sepete Ekle
												</a>
											</div>

											<div class="add-to-links d-flex gap-2 align-items-center" style="margin-left: 10px;">
												<a href="javascript:void(0);" class="favori-ekle-kaldir" data-id="@urun.UrunId"
												   style="font-size: 18px; color: #333; transition: 0.2s;">
													<i class="fa fa-heart-o"></i>
												</a>
												<a href="#" data-bs-toggle="modal" data-bs-target="#mymodal-@urun.UrunId"
												   style="font-size: 18px; color: #333; transition: 0.2s;">
													<i class="fa fa-eye"></i>
												</a>
											</div>

										</div>

										<!-- Quick View Modal -->
										<div class="modal fade" id="mymodal-@urun.UrunId" tabindex="-1" role="dialog">
											<div class="modal-dialog" role="document">
												<div class="modal-content">
													<div class="modal-header">
														<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
													</div>
													<div class="modal-body">
														<div class="modal-img">
															<div class="single-img">
																<img src="@urun.UrunResimUrl" alt="@urun.UrunAdi" class="primary" />
															</div>
														</div>
														<div class="model-text">
															<h2>@urun.UrunAdi</h2>

															<div class="price-rate">
																<span class="new-price">@urun.UrunFiyat.ToString("C2")</span>
															</div>
															<div class="short-description mt-20">
																<p>@urun.UrunAciklama</p>
															</div>
															<form method="post" action="/Sepet/Ekle">
																<input type="hidden" name="urunId" value="@urun.UrunId" />
																<input type="number" name="adet" value="1" min="1" max="@urun.Stok" />
																<button type="submit" class="sepete-ekle-btn">Sepete Ekle</button>
															</form>
														</div>
													</div>
												</div>
											</div>
										</div>

									</div>
								</div>
								<!-- single-product-end -->
							</div>
						}
					</div>
				}
				else
				{
					<p>Bu kategoride ürün bulunamadı.</p>
				}
			</div>
		</div>
	</div>

	@section Scripts {
		<script>
			$(document).ready(function () {
				$.get("/Favori/UrunIdler", function (res) {
					if (res && res.urunIdler && Array.isArray(res.urunIdler)) {
						res.urunIdler.forEach(function (id) {
							const btn = $('.favori-ekle-kaldir[data-id="' + id + '"]');
							const icon = btn.find("i");
							icon.removeClass("fa-heart-o").addClass("fa-heart");
						});
					}
				});
			});
		</script>
	}
</div>
